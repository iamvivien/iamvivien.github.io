<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <title>CycleMyLyfe • Level 1</title>
        <meta name="description" content="Road Safety • Level 1">
        <!-- jQuery Plugins -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
		<script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>

		<script>
			AFRAME.registerComponent('collider-check', {
				dependencies: ['raycaster'],
				init: function () {
					var timeout;
					this.el.addEventListener('raycaster-intersection-cleared', function(e) {
				  		var error_text = document.getElementById("error_text");
				  		clearTimeout(timeout);
						error_text.setAttribute('text', {
							align:'center',
							width:12,
							wrapCount:100,
							color:'red',
							value:'You have hit someone or something! Please be careful.'
						});

						timeout = setTimeout(function(){
							error_text.setAttribute('text', {
								align:'center',
								width:3,
								wrapCount:100,
								color:'red',
								value:''
							});
						}, 4000);
					});
				}
			});

		</script>
	</head>
	<body>
		<a-scene collider-check>
			<!-- ASSETS -->
			<a-assets>
				<a-asset-item id="car" src="models/car_1/scene.gltf"></a-asset-item> 
				<a-asset-item id="woman" src="models/woman/scene.gltf"></a-asset-item>
				<a-asset-item id="road" src="models/road/model.gltf"></a-asset-item>
				<a-asset-item id="sidewalk" src="models/sidewalk/scene.gltf"></a-asset-item>
				<a-asset-item id="bicycle" src="models/bicycle/Bike.gltf"></a-asset-item>
				<a-asset-item id="house" src="models/house/house.gltf"></a-asset-item>
			</a-assets>

			<!-- USER MODEL -->
			<a-entity position="0 1.8 50">
				<a-camera id="cam" user-height="1.8" wasd-controls="acceleration: 100">
					<a-entity gltf-model="#bicycle" scale="0.001 0.001 0.001" position="0 -0.5 0" rotation="0 180 0"></a-entity>
					<!-- <a-text id="error_text" value="Oh no you hit something/someone! Please be careful." position="0 2.138 -5.991" text="align:center" visible="false"></a-text> -->
					<a-entity id="error_text" position="0 2.138 -5.991"></a-entity>
					<a-sphere raycaster="objects: .collidable; far: 0.4" position="0 0 0" geometry="radius:0.5"></a-sphere>
					<a-entity raycaster="objects: .collidable; far: 0.4" rotation="0 25 0"></a-entity>
					<a-entity raycaster="objects: .collidable; far: 0.4" rotation="0 335 0"></a-entity>
				</a-camera>
			</a-entity>
				
			<!-- ROADS AND WALKWAY -->
			<a-entity id="4" gltf-model="#sidewalk" scale="0.02 0.02 0.02" position="2.854 0.431 3.429" rotation="0 90 0"></a-entity>
		  	<a-entity id="5" gltf-model="#sidewalk" scale="0.02 0.02 0.02" position="2.854 0.431 42.45" rotation="0 90 0"></a-entity>
			<a-entity id="6" gltf-model="#road" scale="4 4 4" position="-4.926 -3.92 -5.702" rotation="0 0 0"></a-entity>
			<a-entity id="7" gltf-model="#road" scale="4 4 4" position="-4.926 -3.92 17.607" rotation="0 0 0"></a-entity>
		  	<a-entity id="8" gltf-model="#road" scale="4 4 4" position="-4.926 -3.92 40.76" rotation="0 0 0"></a-entity>
			<a-entity id="9" gltf-model="#road" scale="4 4 4" position="-16.143 -3.933 -5.734" rotation="0 0 0"></a-entity>
			<a-entity id="10" gltf-model="#road" scale="4 4 4" position="-16.143 -3.918 17.509" rotation="0 0 0"></a-entity>
		  	<a-entity id="11" gltf-model="#road" scale="4 4 4" position="-16.143 -3.918 40.76" rotation="0 0 0"></a-entity>

		  	<!--Buildings -->
		  	<a-entity id="12" gltf-model="#house" position="-20 -3.918 40.76"></a-entity>

			<!-- GROUND AND SKY -->
			<a-entity id="13" environment="ground: flat; groundColor:#454545; groundColor2:#454545;"></a-entity>

			<!-- CAR -->
			<a-entity id="1" class="collidable" geometry="primitive: box" gltf-model="#car" scale="0.02 0.02 0.02" position="-4 0.5 -18.960" rotation="0 0 0">
				<a-animation attribute="position"
			  		dur="20000"
			  		fill="forwards"
			  		to="-4 0.5 50.686"
			  		repeat="indefinite"
			  		>
		  		</a-animation>
		  	</a-entity>

			<!-- CAR OPPOSITE DIRECTION -->
			<a-entity id="2" name="car" class="collidable" geometry="primitive: box" gltf-model="#car" scale="0.02 0.02 0.02" position="-16 0.5 57.654" rotation="0 180 0">
				<a-animation attribute="position"
			  		dur="10000"
			  		fill="backwards"
			  		to="-16 0.5 -12.967"
			  		repeat="indefinite"
			  		>
		  		</a-animation>
			</a-entity>

			<!-- WOMAN -->
			<a-entity id="woman123" name="woman" class="collidable" geometry="primitive: box" gltf-model="#woman" scale="0.011 0.011 0.011"  position="5.752 0.5 -14.869" rotation="0 0 0">
				<a-animation attribute="position"
			  		dur="25000"
			  		fill="forwards"
			  		to="5.752 0.5 59.746"
			  		repeat="indefinite"
			  		>
		  		</a-animation>
			</a-entity>

			<!-- WOMAN TEXT MESSAGE -->
			<a-text id="woman1" value="Please keep to one side when sharing pedestrain walkways" geometry="primitive:plane;height:0.5;width:5" position="5.752 2.7 -14.869" text="align:center" visible="true">
			    <a-animation attribute="position"
	               	dur="25000"
	                fill="forwards"
	                to="5.752 2.7 59.746"
	                repeat="indefinite">         
			    </a-animation>
   			</a-text>

   			<!-- CAR MESSAGE -->
		  	<a-text id="carmsg" value="Please stay clear of oncoming traffic and obey traffic rules" geometry="primitive:plane;height:0.5;width:5" position="-4 2.494 -18.960" text="align:center" visible="true">
			    <a-animation attribute="position"
	               	dur="20000"
	                fill="forwards"
	                to="-4 2.494 50.686"
	                repeat="indefinite">         
			    </a-animation>
   			</a-text> 
		</a-scene>

		<!-- jQuery Plugins -->
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
	</body>
</html>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>CycleMyLyfe • Level 3</title>
        <meta name= "apple-mobile-web-app-capable" content="Road Safety • Level 3">
        <meta name= "viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
        <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
        <script src="js/aframe-dialog-popup-component.js"></script>
        <script src="https://unpkg.com/aframe-teleport-controls@0.2.x/dist/aframe-teleport-controls.min.js"></script>
        <script src="https://unpkg.com/aframe-controller-cursor-component@0.2.x/dist/aframe-controller-cursor-component.min.js"></script>


        <!-- ADD THESE SCRIPTS FOR TRAFFIC LIGHT'S ANIMATION -->
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
        <script src="https://rawgit.com/donmccurdy/aframe-extras/v2.1.1/dist/aframe-extras.loaders.min.js"></script>
    </head>

    <body>
    <a-scene>
        <!-- ASSETS -->
        <a-assets>
            <img id="pedestrian" src="images/stickman.png">
            <img id="cyclist" src="images/cyclists.png">
            <a-asset-item id="street" src="models/city_1/scene.gltf"></a-asset-item>
            <a-asset-item id="traffic" src="models/traffic_light/scene.gltf"></a-asset-item>
            <a-asset-item id="bicycle" src="models/bicycle/Bike.gltf"></a-asset-item>
        </a-assets>

        <!-- USER MODEL -->
        <a-entity id ="firstEntity" position="0 1.8 -0.5">
            <a-camera id="cam" user-height="1.8" wasd-controls="acceleration: 100" >
                <a-entity position="0 0 -4.49"
                          geometry="primitive: ring; radiusInner: 0.2; radiusOuter: 0.3;"
                          material="color: black; shader: flat"
                          cursor="maxDistance: 30; fuse: true">
                </a-entity>
                <a-entity id="user_bicycle" gltf-model="#bicycle" scale="0.001 0.001 0.001" position="0 -0.780 -0.5" rotation="0 180 0">  </a-entity>
            </a-camera>
        </a-entity>

        <!-- STREET ENVIRONMENT -->
        <a-entity gltf-model="#street" scale="0.04 0.04 0.04" position="11.5 4.904 7"></a-entity>
        <a-entity gltf-model="#traffic" scale="0.05 0.05 0.05" position="24.767 0.2 -17.3" rotation="0.4 8.5 1.5" animation-mixer></a-entity>
        <a-sphere position="24.75 2.85 -17" radius="0.2" color="green"></a-sphere>

        <a-box id="firstClose" color="red" width="0.5" height="0.5" depth="0.001"
               position="1.2 3.1 -4.9"
               text="align: center; color: black; value: Close;  wrap-count:5 ">
        </a-box>

        <a-box color="pink" id="firstMsg" width="3" height="3" depth="0.001"
               position="0 2 -5"
               text="align: center; color: black; value: Please cycle to your right >>>; wrap-count:30">
        </a-box>

        <a-box id="question1" color="aliceblue" width="3" height="3" depth="0.001" position="24.5 2 -5" rotation="0 -85 0"
               text="align: center; color: black; value: You have reached a pedestrian crossing. Should you continue to cycle across?; wrap-count:25">
        </a-box>

        <a-box id="yes" color="yellowgreen" width="0.5" height="0.5" depth="0.001" position="24.45 1 -5.5" rotation="0 -85 0">
            <a-text  color="black" align="center" width="3" font="aileronsemibold" value="Yes" ></a-text>
        </a-box>

        <a-box id="no" color="tomato" width="0.5" height="0.5" depth="0.001" position="24.45 1 -4.5" rotation="0 -85 0">
            <a-text  color="black" align="center" width="3" font="aileronsemibold" value="No" ></a-text>
        </a-box>
    </a-scene>

    <script>
        document.querySelector('#yes').addEventListener('fusing', function (evt) {
            var messagebox1 = document.createElement('a-box');
            var successText = document.createElement('a-text');
            messagebox1.setAttribute('position', "24.4 2 -5");
            messagebox1.setAttribute('width', 3);
            messagebox1.setAttribute('height', 3);
            messagebox1.setAttribute('depth', 0.001);
            messagebox1.setAttribute('rotation', "0 -85 0");
            messagebox1.setAttribute('color', "snow");
            messagebox1.setAttribute('id', "msg1");


            successText.setAttribute('value', "NO! Do not cycle across pedestrian crossings. You should dismount and push your bicycle.");
            successText.setAttribute('wrap-count', "25");
            successText.setAttribute('align', "center");
            successText.setAttribute('width', 3);
            successText.setAttribute('font', "aileronsemibold");
            successText.setAttribute('color', "black");

            var msgBox1 = document.querySelector('#no');
            msgBox1.parentNode.removeChild(msgBox1);
            var msgBox2 = document.querySelector('#question1');
            msgBox2.parentNode.removeChild(msgBox2);
            var msgBox3 = document.querySelector('#yes');
            msgBox3.parentNode.removeChild(msgBox3);

            document.querySelector('a-scene').appendChild(messagebox1);
            document.querySelector('#msg1').appendChild(successText);
            
            afterFirstQuestion();
        });

        document.querySelector('#no').addEventListener('fusing', function (evt) {
            var messagebox1 = document.createElement('a-box');
            var successText = document.createElement('a-text');
            messagebox1.setAttribute('position', "24.4 2 -5");
            messagebox1.setAttribute('width', 3);
            messagebox1.setAttribute('height', 3);
            messagebox1.setAttribute('depth', 0.001);
            messagebox1.setAttribute('rotation', "0 -85 0");
            messagebox1.setAttribute('color', "snow");
            messagebox1.setAttribute('id', "msg1");


            successText.setAttribute('value', "Well done! You have obeyed traffic rules. Keep up the good work on practicing good cycling etiquette.");
            successText.setAttribute('wrap-count', "25");
        
            successText.setAttribute('align', "center");
            successText.setAttribute('width', 3);
            successText.setAttribute('font', "aileronsemibold");
            successText.setAttribute('color', "black");

            document.querySelector('a-scene').appendChild(messagebox1);
            document.querySelector('#msg1').appendChild(successText);

            var msgBox1 = document.querySelector('#no');
            msgBox1.parentNode.removeChild(msgBox1);
            var msgBox2 = document.querySelector('#question1');
            msgBox2.parentNode.removeChild(msgBox2);
            var msgBox3 = document.querySelector('#yes');
            msgBox3.parentNode.removeChild(msgBox3);
            
            afterFirstQuestion();
        });

        document.querySelector('#firstClose').addEventListener('fusing', function (evt) {
            var msgBox1 = document.querySelector('#firstMsg');
            msgBox1.parentNode.removeChild(msgBox1);
            var msgBox2 = document.querySelector('#firstClose');
            msgBox2.parentNode.removeChild(msgBox2);
            
            var movement = document.createElement('a-animation');
            movement.setAttribute('attribute', "position");
            movement.setAttribute('dur', "5000");
            movement.setAttribute('fill', "forwards");
            movement.setAttribute('to', "0 0 -4");
            document.querySelector('#cam').appendChild(movement);
            
           setTimeout(moveToFirstQuestion, 5500);
        });
              
        function moveToFirstQuestion() {  
            var movement = document.createElement('a-animation');
                    movement.setAttribute('attribute', "position");
                    movement.setAttribute('dur', "5000");
                    movement.setAttribute('fill', "forwards");
                    movement.setAttribute('to', "20.05 0 -3");
                    document.querySelector('#cam').appendChild(movement);
        }

        function afterFirstQuestion() {
            var movement = document.createElement('a-animation');
                    movement.setAttribute('attribute', "position");
                    movement.setAttribute('dur', "5000");
                    movement.setAttribute('fill', "forwards");
                    movement.setAttribute('to', "23 0 -4");
                    document.querySelector('#cam').appendChild(movement);
        }  
    </script>
</body>
</html>